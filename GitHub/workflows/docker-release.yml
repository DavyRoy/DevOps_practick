name: Docker Release

on:
  push:
    branches:
      - main  # —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—É—à–µ –≤ main

jobs:
  docker-release:
    name: üê≥ Build & Push Docker Image
    runs-on: ubuntu-latest

    steps:
      # 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      - name: üì• Checkout repo
        uses: actions/checkout@v3

      # 2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Docker Buildx
      - name: üîß Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      # 3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ DockerHub
      - name: üîê Login to DockerHub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      # 4. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (–±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏)
      - name: üõ†Ô∏è Build Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: false
          tags: yourusername/appname:latest
          outputs: type=docker  # –ª–æ–∫–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞

      # üëâ –ú–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–ª–∏ echo
      - name: ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏
        run: echo "–û–±—Ä–∞–∑ —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏..."

      # 5. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞
      - name: üì§ Push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: yourusername/appname:latest
